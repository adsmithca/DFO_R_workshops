---
title: "Project management: How to effectively organize a project in R"
author: "Paul Regular and Keith Lewis"
date: "NAFC | Fisheries and Oceans Canada | October 26, 2017"
output: 
  ioslides_presentation:
    incremental: true
    widescreen: true
    logo: rproj.png
---


```{r setup, echo=FALSE, results="hide", message=FALSE, warning=FALSE}
knitr::opts_knit$set(root.dir = '../')
knitr::opts_chunk$set(cache = TRUE, 
                      fig.align = "center", 
                      fig.height = 4.5, 
                      fig.width = 7.5,
                      dev = "svg")
```


# Examples of what not to do!!!

## Uncommented code

<img src="screenshots/uncommented.png" width="55%" />

## Long chunks of code

<img src="screenshots/LONG.png" width="22%" />

## Inconsistent style

<img src="screenshots/poor_style.png" width="100%" />

## All files in one folder

<img src="screenshots/many_files.png" width="65%" />

## No metadata and/or project description

<img src="screenshots/no_metadata.png" width="85%" />

## Repeating yourself (copy/paste, copy/paste, ...)

<img src="screenshots/repeat.png" width="100%" />

## Copy/paste results into MS WORD

<img src="screenshots/word_whoops.png" width="85%" />

## Lots of versions of a file

<img src="screenshots/many_versions.png" width="52%" />  <img src="http://phdcomics.com/comics/archive/phd101212s.gif" width="37%" />

## Best practices

- Uncommented code; *Write for yourself 6 mo. from now*
- Long chunks of code; *Split code into tasks*
- Inconsistent style; *Suscribe to a style guide*
- All files in one folder; *Nest similar file types in folders*
- No metadata and/or project description; *Make a DESCRIPTION and README file*
- Repeating yourself; *Use functions*
- Copy/paste results into MS WORD; *Use Rmarkdown*
- Lots of versions of a file; *Use a version control system (e.g. git)*

## Workshop outline of next 4 weeks

> - Today: Project management: how to effectively organize a project in R
> - November 9th: The very basics of programming in R: functions, debugging, warnings and errors, tests, data types
> - November 23rd: Rmarkdown and reproducible research
> - December 7: Keeping track of your work using version control with git (not just for R users!)

## Objectives {.build}

- Introduce the concept of a Research Compendium
- Demonstrate the set-up and workflow of a compendium
- Give a brief teaser of custom functions, Rmarkdown and git

## Research Compendium

- What is it?
    - A compendium is a convention for how to organize key files for a project (data, code, text, etc.) into directories
- Why use one?
    - Simplifies file management
    - Streamlines analytical workflows
    - More efficient for you, future you and your collaborators
    - Reproducible and extensible
- How should files be organized?
    - Apply the conventions used for building an R package
    
## Getting started {.smaller}

Use the `devtools` package to set-up the structure

```{r, eval=FALSE}

## Project path and name
root_dir <- "."                                         # path to your project
proj_name <- "skeleton"                                 # project name

## Metadata for the project
proj_metadata <- list("Title" = "Project title",
                      "Authors@R" = person("First", "Last", 
                                          email = "first.last@example.com", 
                                          role = c("aut", "cre")),
                      "Description" = "This is a research compendium for...",
                      "License" = "NA")

## Generate the skeleton for the project
devtools::create(file.path(root_dir, proj_name),
                 description = proj_metadata)           # generates a minimum R package skeleton
devtools::use_git(pkg = file.path(root_dir, proj_name)) # Initalize local git repository
dir.create(file.path(root_dir, proj_name, "data"))      # adds a data folder to the directory
dir.create(file.path(root_dir, proj_name, "analysis"))  # adds an analysis folder to the directory

```


## Core structure {.smaller}

Code on the last slide generates a structure similar to the one recommended here: https://github.com/ropensci/rrrpkg

```
skeleton
|
|- skeleton.Rproj       # RStudio Rproj file; one file to rule them all
|
|- DESCRIPTION          # project metadata and dependencies 
|
|- data/                # raw data, not changed once created
|  +- my_data.csv       # data files in open formats such as TXT, CSV, TSV, etc.
|
|- R/                   # reusable code
|  +- my_functions.R    # custom R functions that are used more than once in the project
|
|- analysis/            # any programmatic code 
|  +- my_scripts.R      # R code or R markdown files used to analyse and visualise data 

```


## Workflow - step 1 {.smaller}

Setup the compendium

```{r, eval=FALSE}

## Project path and name
root_dir <- "."                                         # path to your project
proj_name <- "strat"                                    # project name

## Metadata for the project
proj_metadata <- list("Title" = "Stratified analysis of shrimp, cod, halibut and redfish population trends",
                      "Authors@R" = c(person("Paul", "Regular", email = "Paul.Regular@dfo-mpo.gc.ca", 
                                             role = c("aut", "cre")),
                                      person("Keith", "Lewis", email = "Keith.Lewis@dfo-mpo.gc.ca", 
                                             role = "aut")),
                                      "Description" = "This is a research compendium for stratified
                                                       analysis of shrimp population trends.",
                                      "License" = "NA")

## Generate the skeleton for the project
devtools::create(file.path(root_dir, proj_name),
                 description = proj_metadata)           # generates a minimum R package skeleton
devtools::use_git(pkg = file.path(root_dir, proj_name)) # Initalize local git repository
dir.create(file.path(root_dir, proj_name, "data"))      # adds a data folder to the directory
dir.create(file.path(root_dir, proj_name, "analysis"))  # adds an analysis folder to the directory

```

## Workflow - step 2

Add the data

```
|- data/
|-  +- trawl_abiotic.csv
|-  +- trawl_biotic.csv

```
- These data should remain static


## Workflow - step 3

Open `strat.Rproj` in RStudio

- Working directory will automatically = project directory

## Workflow - step 4

Save an R script in the analysis folder and start writing code
```
|- analysis/
|-   +- strat_analysis.R
```
- Work from the project directory (e.g. `read.csv("data/trawl_biotic.csv")`)
- If your script grows too long, it may be useful to split and number scripts
    ```
    |- analysis/
    |-   +- 001_manipulate.R
    |-   +- 002_visualize.R
    |-   +- 003_model.R
    ```

## Extras

- Functions (+ taking advantage of an R package setup)
- Rmarkdown
- git
- TODO: add teaser slides on these topics


## Exercises

- Set-up a research compendium for an analysis of habitat (depth and/or temperature) associations for shrimp, cod, halibut and/or redfish
    - Modify the metadata
    - Add the the biotic and abiotic csv files to the data folder
    - Write a script to:
        - Merge biotic and abiotic datasets
        - Make and export some figures
- For the adventurous: convert one of your projects to a compendium


## References

> - This presentation was heavily based on this really useful doc: https://github.com/ropensci/rrrpkg
> - For more details on building R packages, see: [Wickham, Hadley, R Packages: Organise, test, document, and share your code. O'Reilly.](http://r-pkgs.had.co.nz/)
> - Keep an eye on in development packages to simplify reproducable research in R: https://github.com/benmarwick/rrtools
> - Hadley Wickham's R style guide: http://adv-r.had.co.nz/Style.html

