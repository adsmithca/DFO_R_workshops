---
title: "Dynamic Documents, R, and Markdown"
subtitle: "a key component of reproducible research"
author: "Keith P. Lewis"
date: "NAFC | Fisheries and Oceans Canada | 2017-11-26"
output: 
  ioslides_presentation:
    incremental: true
    widescreen: true
    logo: rmarkdown.png
---

```{r setup, echo=FALSE, results="hide", message=FALSE, warning=FALSE}
knitr::opts_knit$set(root.dir = '../')
knitr::opts_chunk$set(cache = TRUE, 
                      fig.align = "center", 
                      fig.height = 4.5, 
                      fig.width = 7.5,
                      dev = "svg")
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
```

## RStudio Tips

## Before we get started
- Were you able to create a new file using the RMarkdown option?

## Overview
- Workflows: What i've learned....so far
- Reproducible Research (RR): reasons and benefits
- Dynamic Documents with RMarkdown
    - basics
    - intermediate
    - advanced

## Workflow
<style> 
  #slideID > p { 
    margin-top: -50px; 
  } 
</style>
<img src="figures/1_generic_workflow.PNG" width="95%" />

## Workflow evolution 1
<style> 
  #slideID > p { 
    margin-top: -50px; 
  } 
</style>
<img src="figures/2_workflow_chaos.PNG" width="95%" />

## Workflow evolution 2
<style> 
  #slideID > p { 
    margin-top: -50px; 
  } 
</style>
<img src="figures/3_workflow_improvements.PNG" width="95%" />

## Workflow evolution 3
<style> 
  #slideID > p { 
    margin-top: -50px; 
  } 
</style>
<img src="figures/4_workflow_current_state.PNG" width="95%" />

## Reproducible Research (RR)
- Reproducibility is a cornerstone of science
- Reproducibility is increasingly difficult because of:
    - complex statistics
    - multiple authors increased collaboration
    - Big data: data decisions
- However, without the code and data, a manuscript is not reproducible

## Benefits of RR {.smaller}
- Idealistic: 
    - RR makes for better science (or helps prevents bad science)
    - see WSBpaper******
    - Analogy:
      - prevention ~ education
      - medication (traditional) ~  peer-review + editor
      - medication (modern) ~  peer-review + editor + RR
  
- Practical:
    - streamline workflow
    - rapidly update your own work
    - organize and retrieve analyses
    - rescue projects
    - improved collaboration and review of projects

## Dynamic Documents
- Word processing (WYSIWYG) v document preparation (WYSISYM)
  - Seperates writing from formatting
  - other advantages *******
- Examples:
  - Markdown
  - LaTeX (LyX)
- knitr (Yihui Xie)

## Objectives
- produce an document (html, pdf, or Word) in Rmarkdown
- make it pretty
- make it dynamic
- work on these ******

## RMarkdown: the basics
<img src="screenshots/rmarkdown1.png" width="95%" />

## RMarkdown: the basics of "chunks"
- The "r chunk"
- ```r{} starts the chunk
- ``` ends the chunk
- The "text chunk"
  - e.g. "In a hole in the ground there lived a hobbit....."

## Basic Exercises

## Intermediate RMarkdown - prettify the document
- Change the YAML header
- Add headers to the text
- Add a label and a caption
- Control what to display

## RMarkdown: intermediate
Modify the YAML header and add headers
<img src="screenshots/rmarkdown1.png" width="95%" />

## RMarkdown: intermediate "chunks"
- ```r{} starts the chunk
- ``` ends the chunk
- But you can add loads of stuff to r{}
  - Add a label and a caption - r{fig.cap = "the title"}
  - Control what to display
    - code r{echo = F}
    - warnings r{warnings = F}
    - messages r{messages = F}
    - results r{results = "hide"}

## Intermediate exercises
Copy the first exercise to a new file and produce the following document

## Advanced RMarkdown
- label a figure in the text
- make a table (kable, xtable, stargazer)
- calculate a parameter and insert into text
- update the document

## Label a figure and make a table
{r, "name the figure"}

make the 

## Tangent alert: lists
```{r}
summary(lm(depth~year, data=abiotic_abrev))
summary
```

## Tangent alert: lists
```{r}
m1 <- summary(lm(depth~year, data=abiotic_abrev))
str(m1)
```

## Tangent alert: lists
```{r}
m1 <- summary(lm(depth~year, data=abiotic_abrev))
m1$r.squared
```

## Advanced exercises
- Copy the second exercise to a new file and produce the following document


- .....then update it :)
  
## Next steps RMarkdown
 - YAML headers
 - hooks
 - inserting graphics
 - Presentations (ioslides and RPres)
 - Posters (dashboard)
 - Adding bibliographies
 - templates
 - insert equations

## Summary: other options
- Compile Notebook
- TeX/LaTeX
    - LyX
    - BibTeX
  - Beamer

## A graphical model for RR and open science using dynamic documents (Lewis et al. accepted) {.smaller}
<style> 
  #slideID > p { 
    margin-top: -100px; 
  } 
</style>
<img src="figures/5_open-science-model.png" width="80%" />

## Help {.smaller}
Books
Xie, Y. 2013. Dynamic Documents with R and knitr. CRC Press, London.
Gandrud, C. 2014. Reproducible Research with R and RStudio. 2nd Edition. CRC Press, Boca Raton, FL. 

Cheatsheets
http://ropensci.github.io/reproducibility-guide/sections/introduction/
https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf

Reproducible Research webpages
http://ropensci.github.io/reproducibility-guide/sections/introduction/

Knitr or Markdown webpages
https://yihui.name/knitr/
https://support.rstudio.com/hc/en-us/articles/205368677-R-Markdown-Dynamic-Documents-for-R
https://sachsmc.github.io/knit-git-markr-guide/knitr/knit.html
http://kbroman.org/knitr_knutshell/pages/Rmarkdown.html

YAML
http://rmarkdown.rstudio.com/html_document_format.html
http://rmarkdown.rstudio.com/pdf_document_format.html
http://rmarkdown.rstudio.com/word_document_format.html

## Sample document
- Zuur's Exploratory data analysis - put on Github
